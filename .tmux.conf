# Terminal settings
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",xterm-ghostty:Tc"
set -ga terminal-overrides ",xterm-256color*:Tc"

# Ghostty passthrough (for images/graphics)
set -g allow-passthrough on

# Undercurl support (for Neovim LSP diagnostics)
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'

# Extended keys (Ctrl+Shift combos)
set -g extended-keys on
set -as terminal-features ',xterm-ghostty:extkeys'

# Prefix key: Ctrl+a (easier than Ctrl+b)
unbind C-b
set -gw prefix C-a
bind a send-prefix

# Open new panes/windows in same directory
bind c new-window -c "#{pane_current_path}"
bind '"' split-window -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"

# Faster escape time (for vim)
set-option -sg escape-time 10
set-option -g focus-events on

# Window navigation (shift+arrow)
bind -n S-down new-window
bind -n S-left prev
bind -n S-right next
bind -n C-left swap-window -t -1
bind -n C-right swap-window -t +1

# Vim-like pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# History
set -g history-limit 50000

# Renumber windows when one closes (no gaps)
set -g renumber-windows on

# Quick config reload
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# Longer display time for messages
set -g display-time 2000
set -g display-panes-time 2000

# Sync tmux window name to terminal (Ghostty tab) title
set -g set-titles on
set -g set-titles-string "#S:#W"

# Vi-style copy mode (trying this out)
# prefix+[ to enter, v to select, y to yank to clipboard
setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"

# Auto-rename windows to current directory
setw -g automatic-rename-format "#{b:pane_current_path}"

# ============================================================================
# Plugins
# ============================================================================

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Continuum settings (auto-save/restore sessions)
set -g @continuum-restore 'on'
set -g @continuum-boot 'off'
set -g @continuum-boot-options 'ghostty,fullscreen'

# ============================================================================
# Theme (Poimandres-inspired)
# ============================================================================

set -g status "on"
set -g status-justify "left"
set -g status-style "none,bg=default"
set -g status-left-style "none"
set -g status-left-length "100"
set -g status-right-style "none"
set -g status-right-length "100"

# Pane borders
set -g pane-border-style "fg=#33394a,bg=default"
set -g pane-active-border-style "fg=#404350,bg=default"
set -g pane-border-status bottom
set -g pane-border-format ""

# Messages
set -g message-style "fg=brightwhite,bg=default"
set -g message-command-style "fg=brightwhite,bg=default"

# Window status
setw -g window-status-activity-style "none"
setw -g window-status-separator " "
setw -g window-status-style "none,fg=brightwhite,bg=default"

# Status bar
set -g status-left "#[fg=#5de4c7,bg=default,bold]#S #[fg=brightwhite,bg=default,nobold,nounderscore,noitalics]"
set -g status-right "#[fg=#868cad,bg=default]%I:%M%p #[fg=#868cad,bg=default] %m/%d/%Y "
set -g window-status-format '#[fg=#5fb3a1,bg=default] #I#[fg=#868cad,bg=default] #W '
set -g window-status-current-format '#[fg=#5de4c7,bg=default] #I#[fg=#ffffff,bg=default] #W '
set -g status-interval 5

# ============================================================================
# Initialize TPM (keep at bottom)
# ============================================================================

run -b '~/.tmux/plugins/tpm/tpm'
